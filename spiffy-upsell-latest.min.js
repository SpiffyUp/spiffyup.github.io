(function($,window,document,undefined){"use strict";var pluginName="upsells",defaults={buttonText:"Yes, Add to Order for {upsell_cost}!",noThanksText:"No thanks! Continue without adding to order",noticeText:"<strong>Order Not Yet Complete!</strong> See below to finish your order"};function Plugin(element,options){this.element=element;this.settings=$.extend({},defaults,options);this._defaults=defaults;this._name=pluginName;this.init()}$.extend(Plugin.prototype,{init:function(){var upsell=this;$("#UP_SELLS").hide();upsell.ua_interval=setInterval(function(){upsell.actionUpsell()},250);upsell.ca_interval=setInterval(function(){upsell.actionCheckout()},250);$("form").on("submit.sp_upsell",function(e){console.log("Order submitted");if(upsell.upsellAction==undefined||upsell.checkoutAction==undefined){console.log("ERROR: Failed to load up sell");return true}if($(".productCell a").length<1&&$("#submitted").val()!="true"){e.preventDefault();console.log("Trigger upsell");$(window).bind("beforeunload",function(){return"Your order has NOT been processed. Are you sure you want to leave?"});$("#spiffy-loader").hide();var upsell_cost=$("#UP_SELLS .upsellPrice").text();upsell.settings["buttonText"]=upsell.settings["buttonText"].replace("{upsell_cost}",upsell_cost);$("body").append('<div id="spiffyUpsell"><div class="row"><div class="column small-12 spUpsellNotice text-center alert-box warning">'+upsell.settings["noticeText"]+'</div><div class="column small-12 inner"></div><div class="column small-12 spUpsellButtons text-center"><a href="#" class="sp-acceptupsell button large">'+upsell.settings["buttonText"]+'</a><a href="#" class="sp-nothanks">'+upsell.settings["noThanksText"]+"</a></div></div></div>");$("#spUpsellContent").appendTo("#spiffyUpsell .inner");jQuery("#spiffyUpsell iframe").attr("src",jQuery("#spiffyUpsell iframe").attr("src")+"?autoplay=1");$("#spUpsellContent, #spiffyUpsell").show();$("body").addClass("spDisableScroll");$(".sp-acceptupsell").on("click",function(){upsell.spProcessUpsell()});$(".sp-nothanks").on("click",function(){upsell.spProcessOrder()})}});console.log("Spiffy Upsell Initialized")},spProcessOrder:function(){var upsell=this,checkoutAction=upsell.checkoutAction;upsell.showLoader();jQuery(window).unbind("beforeunload");jQuery("form").off("submit.sp_upsell");jQuery("#submitted").val("false");eval(checkoutAction);console.log("Processing Order: "+checkoutAction)},spProcessUpsell:function(){var upsell=this,upsellAction=this.upsellAction;upsell.showLoader();console.log("Adding Upsell: "+upsellAction);upsell.allowProcessOrder=1;console.log("Waiting for order form reload");jQuery(document).ajaxStop(function(){if(upsell.allowProcessOrder){upsell.allowProcessOrder=0;upsell.spProcessOrder()}});eval(upsellAction)},actionUpsell:function(){console.log("checking upsell action");if($(".upsellButton").length>0){this.upsellAction=$(".upsellButton").attr("onclick")}console.log(this.upsellAction);if(this.upsellAction!=undefined){window.clearInterval(this.ua_interval)}},actionCheckout:function(){console.log("checking checkout action");if($(".checkoutLinks .continueButton").length>0){this.checkoutAction=$(".checkoutLinks .continueButton").attr("href");if($(".checkoutLinks .continueButton.terms").length>0){if(this.checkoutAction!=""&&window.checkoutAction!=undefined){this.checkoutAction=window.checkoutAction}}}console.log(this.checkoutAction);if(this.checkoutAction!=undefined&&this.checkoutAction!=""){window.clearInterval(this.ca_interval)}},showLoader:function(){if(typeof spiffyEnableLoader=="function"){$("#spUpsellContent iframe").remove();spiffyEnableLoader()}},triggerSpiffyUpsell:function(){jQuery("form").trigger("submit")}});$.fn[pluginName]=function(options){return this.each(function(){if(!$.data(this,"plugin_"+pluginName)){$.data(this,"plugin_"+pluginName,new Plugin(this,options))}})}})(jQuery,window,document);