!function($,window,document,undefined){"use strict";function Plugin(e,t){this.element=e,this.settings=$.extend({},defaults,t),this._defaults=defaults,this._name=pluginName,this.init()}var pluginName="upsells",defaults={buttonText:"Yes, Add to Order for {upsell_cost}!",noThanksText:"No thanks! Continue without adding to order",noticeText:"<strong>Order Not Yet Complete!</strong> See below to finish your order",action_checkout:$(".checkoutLinks .continueButton").attr("href"),action_upsell:$(".upsellButton").attr("onclick")};$.extend(Plugin.prototype,{init:function(){var e=this;$("#UP_SELLS").hide(),$("form").on("submit",function(t){if($(".productCell a").length<1&&"true"!=$("#submitted").val()){t.preventDefault();var s=setInterval(function(){"true"==$("#submitted").val()&&$("#submitted").trigger("change")},250);$("#submitted").on("change",function(){$("#submitted").off("change"),clearInterval(s);var t=$("#UP_SELLS .upsellPrice").text();e.settings.buttonText=e.settings.buttonText.replace("{upsell_cost}",t),$("body").append('<div id="spiffyUpsell"><div class="row"><div class="column small-12 spUpsellNotice text-center alert-box warning">'+e.settings.noticeText+'</div><div class="column small-12 inner"></div><div class="column small-12 spUpsellButtons text-center"><a href="#" class="sp-acceptupsell button large">'+e.settings.buttonText+'</a><a href="#" class="sp-nothanks">'+e.settings.noThanksText+"</a></div></div></div>"),$("#spUpsellContent").appendTo("#spiffyUpsell .inner"),jQuery("#spiffyUpsell iframe").attr("src",jQuery("#spiffyUpsell iframe").attr("src")+"?autoplay=1"),$("#spUpsellContent, #spiffyUpsell").show(),$("body").addClass("spDisableScroll"),$(".sp-acceptupsell").on("click",function(){e.spProcessUpsell()}),$(".sp-nothanks").on("click",function(){e.spProcessOrder()})})}}),console.log("Spiffy Upsell Initialized")},spProcessOrder:function(){jQuery("form").off("submit"),jQuery("#submitted").val("false"),eval(this.settings.action_checkout),console.log("Processing Order: "+this.settings.action_checkout)},spProcessUpsell:function(){var upsell=this;console.log("Adding Upsell: "+upsell.settings.action_upsell),eval(upsell.settings.action_upsell),upsell.allowProcessOrder=1,console.log("Waiting for order form reload"),jQuery(document).ajaxStop(function(){upsell.allowProcessOrder&&(upsell.allowProcessOrder=0,upsell.spProcessOrder())})},triggerSpiffyUpsell:function(){jQuery("form").trigger("submit")}}),$.fn[pluginName]=function(e){return this.each(function(){$.data(this,"plugin_"+pluginName)||$.data(this,"plugin_"+pluginName,new Plugin(this,e))})}}(jQuery,window,document);
