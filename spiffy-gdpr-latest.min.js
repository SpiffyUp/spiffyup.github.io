var spiffyGDPR={};spiffyGDPR=function(options){var defaults={custom_field:"Contact0_EUMarketingOptIn",checkbox_text:"I want to receive future promotions and free training.",checkbox_subtext:"",required:false,required_error:"Please agree to terms",show_always:false};if(!options instanceof Array){console.log("Could not start GDPR checkbox plugin - settings not in an array");return}for(var i=0;i<options.length;i++){options[i]=options[i]||{};for(var opt in defaults){if(defaults.hasOwnProperty(opt)&&!options[i].hasOwnProperty(opt)){options[i][opt]=defaults[opt]}}}console.log(options);spiffyGDPR.settings=options;jQuery(document).ready(function(e){for(var i=0;i<spiffyGDPR.settings.length;i++){initialize(i)}if(typeof billing_hook=="function")var t=billing_hook;billing_hook=function(){if(typeof t=="function"){t()}jQuery("#country").on("change",function(e){for(var i=0;i<spiffyGDPR.settings.length;i++){if(!spiffyGDPR.settings[i].show_always){var t=jQuery(this);if(isEuropeanUnion(t.val())){showGDPRCheckboxes(i)}else{hideGDPRCheckboxes(i)}}}}).trigger("change")}});initialize=function(e){jQuery('<div class="spiffy_gdpr_terms" data-cb-index="'+e+'"><input type="checkbox" name="spiffy_gdpr_terms" id="spiffy_gdpr_terms"/> '+spiffyGDPR.settings[e].checkbox_text+'<br><span style="font-size:10px;">'+spiffyGDPR.settings[e].checkbox_subtext+"</span></div>").css({"font-size":"13px",padding:"0 0 30px 0","text-align":"center"}).insertBefore("#CHECKOUT_LINKS");jQuery('<input type="hidden" value="false" name="'+spiffyGDPR.settings[e].custom_field+'" />').prependTo("#orderForm");jQuery("[data-cb-index="+e+"] input").on("change",function(){jQuery("input[name="+spiffyGDPR.settings[e].custom_field+"]").val(jQuery("[data-cb-index="+e+"] input").is(":checked"))})};injectSpiffy("#CHECKOUT_LINKS",function(){if(jQuery("#CHECKOUT_LINKS a.complete-purchase").length>0&&jQuery("#CHECKOUT_LINKS .gdpr_validations").length<1){bindValidations()}},100);bindValidations=function(){jQuery(".checkoutLinks > a.complete-purchase").each(function(){var original="";if(jQuery(this).attr("href")!=undefined){original=jQuery(this).attr("href").replace(/javascript:/g,"");window.checkoutAction=original;jQuery(this).addClass("gdpr_validations")}else{original=jQuery(this).attr("onclick");jQuery(this).attr("onclick","").addClass("gdpr_validations")}jQuery(this).off("click").on("click",function(event){event.preventDefault();if(validateRequired()){eval(original)}})})};validateRequired=function(){var e=[];for(var i=0;i<spiffyGDPR.settings.length;i++){if(spiffyGDPR.settings[i].required&&!jQuery(".spiffy_gdpr_terms[data-cb-index="+i+"] input").is(":checked")){alert(spiffyGDPR.settings[i].required_error);return false}}return true};hideGDPRCheckboxes=function(e){jQuery(".spiffy_gdpr_terms[data-cb-index="+e+"]").hide()};showGDPRCheckboxes=function(e){jQuery(".spiffy_gdpr_terms[data-cb-index="+e+"]").show()};isEuropeanUnion=function(e){var i=["Austria","Belgium","Bulgaria","Croatia","Cyprus","Czech Republic","Denmark","Estonia","Finland","France","Germany","Greece","Hungary","Ireland","Italy","Latvia","Lithuania","Luxembourg","Malta","Netherlands","Poland","Portugal","Romania","Slovakia","Slovenia","Spain","Sweden","United Kingdom"];if(i.indexOf(e)>=0){return true}return false}};