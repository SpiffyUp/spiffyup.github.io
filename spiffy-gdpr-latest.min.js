var spiffyGDPR={};spiffyGDPR=function(options){var defaults={custom_field:"Contact0_EUMarketingOptIn",checkbox_text:"I want to receive future promotions and free training.",checkbox_subtext:"",required:false,required_error:"Please agree to terms",show_always:false};var countryId="#country",checkoutLinksId="#CHECKOUT_LINKS",changeString="change",clickString="click",onclickString="onclick";if(!options instanceof Array){console.log("Could not start GDPR checkbox plugin - settings not in an array");return}for(var i=0;i<options.length;i++){options[i]=options[i]||{};for(var opt in defaults){if(defaults.hasOwnProperty(opt)&&!options[i].hasOwnProperty(opt)){options[i][opt]=defaults[opt]}}}spiffyGDPR.settings=options;jQuery(document).ready(function(e){for(var i=0;i<spiffyGDPR.settings.length;i++){initialize(i)}if(typeof billing_hook=="function")var t=billing_hook;billing_hook=function(){if(typeof t=="function"){t()}jQuery(countryId).on(changeString,function(e){checkSelectedCountry();jQuery(".spiffy_gdpr_terms input:visible").trigger(changeString)});checkSelectedCountry()}});initialize=function(e){jQuery('<div class="spiffy_gdpr_terms" data-cb-index="'+e+'"><input type="checkbox" name="spiffy_gdpr_terms" id="spiffy_gdpr_terms"/> '+spiffyGDPR.settings[e].checkbox_text+'<br><span style="font-size:10px;">'+spiffyGDPR.settings[e].checkbox_subtext+"</span></div>").css({"font-size":"13px",padding:"0 0 30px 0","text-align":"center"}).insertBefore(checkoutLinksId);jQuery('<input type="hidden" value="false" name="'+spiffyGDPR.settings[e].custom_field+'" />').prependTo("#orderForm");jQuery("[data-cb-index="+e+"] input").on(changeString,function(){var i=jQuery(this).is(":checked");var t=i?i+" "+getTimeStamp():i;jQuery("input[name="+spiffyGDPR.settings[e].custom_field+"]").val(t)})};injectSpiffy(checkoutLinksId,function(){if(jQuery(checkoutLinksId+" a.complete-purchase").length>0&&jQuery(checkoutLinksId+" .gdpr_validations").length<1){bindValidations()}},100);bindValidations=function(){jQuery(".checkoutLinks > a.complete-purchase").each(function(){var original="";if(jQuery(this).attr("href")!=undefined){original=jQuery(this).attr("href").replace(/javascript:/g,"");window.checkoutAction=original;jQuery(this).addClass("gdpr_validations")}else{original=jQuery(this).attr(onclickString);jQuery(this).attr(onclickString,"").addClass("gdpr_validations")}jQuery(this).off(clickString).on(clickString,function(event){event.preventDefault();if(validateRequired()){eval(original)}})})};checkSelectedCountry=function(){for(var e=0;e<spiffyGDPR.settings.length;e++){if(!spiffyGDPR.settings[e].show_always){var i=jQuery(countryId);if(isEuropeanUnion(i.val())){showGDPRCheckboxes(e)}else{hideGDPRCheckboxes(e)}}}};validateRequired=function(){var e=[];for(var i=0;i<spiffyGDPR.settings.length;i++){if(isRequired(i)&&!jQuery(".spiffy_gdpr_terms[data-cb-index="+i+"] input").is(":checked")){alert(spiffyGDPR.settings[i].required_error);return false}}return true};hideGDPRCheckboxes=function(e){jQuery("input[name="+spiffyGDPR.settings[e].custom_field+"]").val("");jQuery(".spiffy_gdpr_terms[data-cb-index="+e+"]").hide()};showGDPRCheckboxes=function(e){jQuery(".spiffy_gdpr_terms[data-cb-index="+e+"]").show()};isRequired=function(e){var i=spiffyGDPR.settings[e],t=jQuery(countryId).val();if(i.required===true){if(i.show_always===false){if(isEuropeanUnion(t)){return true}else{return false}}return true}return false};isEuropeanUnion=function(e){var i=["Austria","Belgium","Bulgaria","Croatia","Cyprus","Czech Republic","Denmark","Estonia","Finland","France","Germany","Greece","Hungary","Ireland","Italy","Latvia","Lithuania","Luxembourg","Malta","Netherlands","Poland","Portugal","Romania","Slovakia","Slovenia","Spain","Sweden","United Kingdom"];if(i.indexOf(e)>=0){return true}return false};function getTimeStamp(){var e=new Date;var i=[e.getMonth()+1,e.getDate(),e.getFullYear()];var t=[e.getHours(),e.getMinutes(),e.getSeconds()];var n=t[0]<12?"AM":"PM";var r=-(e.getTimezoneOffset()/60);t[0]=t[0]<12?t[0]:t[0]-12;t[0]=t[0]||12;for(var a=1;a<3;a++){if(t[a]<10){t[a]="0"+t[a]}}return i.join("/")+" "+t.join(":")+" "+n+" UTC"+r}};